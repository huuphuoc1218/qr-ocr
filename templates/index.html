<!DOCTYPE html>
<html lang="vi">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Camera Capture</title>
    <link
      rel="stylesheet"
      href="{{ url_for('static', filename='style.css') }}"
    />
    <link
      href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap"
      rel="stylesheet"
    />
  </head>

  <body>
    <header class="app-header">
      <h1 class="app-title">·ª®ng d·ª•ng OCR + QR</h1>
    </header>

    <main class="container main-content">
      <div class="grid-2cols">
        <!-- Left Column - Video Stream -->
        <div class="flex-col">
          <div class="video-container">
            <img id="video" src="{{ url_for('video') }}" alt="Video Stream" />
            <div class="video-overlay">Live Camera Feed</div>
          </div>

          <div class="control-panel">
            <button onclick="captureImage()" class="btn btn-primary">
              <span class="icon">üì∑</span>
              Ch·ª•p ·∫£nh
            </button>

            <a href="{{ url_for('gallery') }}" class="btn btn-secondary">
              <span class="icon">üñºÔ∏è</span>
              Xem gallery
            </a>

            <div id="status" class="status-message">
              Ch∆∞a th·ª±c hi·ªán thao t√°c n√†o
            </div>
          </div>
        </div>

        <!-- Right Column - Results -->
        <!-- Thay th·∫ø ph·∫ßn results-section c≈© b·∫±ng ƒëo·∫°n n√†y -->
        <div class="results-container">
          <div class="result-card">
            <h2>K·∫øt qu·∫£ OCR</h2>
            <div class="result-field">
              <label>VƒÉn b·∫£n OCR:</label>
              <span id="result_text" class="result-value">-</span>
            </div>
          </div>

          <div class="result-card">
            <h2>K·∫øt qu·∫£ QR</h2>
            <div class="result-field">
              <label>D·ªØ li·ªáu QR Code:</label>
              <span id="qr_text" class="result-value">-</span>
            </div>
          </div>
        </div>
      </div>
    </main>

    <script>
      async function captureImage() {
        const status = document.getElementById("status");
        status.textContent = "ƒêang ch·ª•p ·∫£nh...";
        status.className = "status-message loading";

        try {
          const response = await fetch("/capture", {
            method: "POST",
            headers: { "Content-Type": "application/json" },
          });

          const data = await response.json();
          status.classList.remove("loading");

          if (!response.ok) {
            throw new Error(data.error || `L·ªói HTTP ${response.status}`);
          }

          status.textContent = data.message || "Ch·ª•p ·∫£nh th√†nh c√¥ng";
          status.className = "status-message status-success";

          if (data.ocr) {
            document.getElementById("result_text").textContent =
              data.ocr.text || "-";
            document.getElementById("qr_text").textContent =
              data.ocr.qr_data || "Kh√¥ng t√¨m th·∫•y m√£ QR";
          }
        } catch (error) {
          console.error("L·ªói khi ch·ª•p ·∫£nh:", error);
          status.textContent = "L·ªói: " + error.message;
          status.className = "status-message status-error";
        }
      }
    </script>
  </body>
</html>
