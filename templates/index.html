<!DOCTYPE html>
<html lang="vi">
  <head>
    <meta charset="UTF-8" />
    <title>Camera Capture</title>
    <link
      rel="stylesheet"
      href="{{ url_for('static', filename='style.css') }}"
    />
  </head>

  <body>
    <h1>Ứng dụng OCR + QR</h1>
    <div class="nd">
      <div class="left">
        <!-- Video Stream -->
        <img id="video" src="{{ url_for('video') }}" alt="Video Stream" />
        <!-- Capture Button -->
        <br />
        <button onclick="captureImage()">Chụp ảnh</button>
        <div class="gallery-link">
          <a href="{{ url_for('gallery') }}">Xem gallery</a>
        </div>
        <!-- Status message -->
        <div id="status">Chưa thực hiện thao tác nào</div>
      </div>

      <div class="right">
        <!-- OCR + QR result -->
        <div id="result-container">
          <h2>Kết quả OCR</h2>
          <p><label>Văn bản OCR:</label> <span id="result_text">-</span></p>
        </div>
        <div id="result-container">
          <h2>Kết quả QR</h2>
          <p><label>Dữ liệu QR Code:</label> <span id="qr_text">-</span></p>
        </div>
      </div>
    </div>

    <script>
      async function captureImage() {
        const status = document.getElementById("status");
        status.innerText = "Đang chụp ảnh...";

        try {
          const response = await fetch("/capture", {
            method: "POST",
            headers: { "Content-Type": "application/json" },
          });
          const data = await response.json();

          if (!response.ok) {
            throw new Error(data.error || `Lỗi HTTP ${response.status}`);
          }

          status.innerText = data.message || "Chụp ảnh thành công";
          alert("Chụp ảnh thành công: " + data.message);

          if (data.ocr) {
            document.getElementById("result_text").innerText =
              data.ocr.text || "-";
            document.getElementById("qr_text").innerText =
              data.ocr.qr_data || "Không tìm thấy mã QR";
          }
        } catch (error) {
          console.error("Lỗi khi chụp ảnh:", error);
          status.innerText = "Lỗi: " + error.message;
        }
      }
    </script>
  </body>
</html>
